# fuckjava-thread-concurrency  [![Build Status](https://travis-ci.com/Byron4j/fuckjava-thread-concurrency.svg?branch=master)](https://travis-ci.com/Byron4j/fuckjava-thread-concurrency)![APM](https://img.shields.io/apm/l/vim-mode.svg?label=License&style=popout) ![](https://img.shields.io/badge/author-%E4%B8%9C%E9%99%86%E4%B9%8B%E6%BB%87-red.svg)

ğŸ˜¨ å…³äº Java çº¿ç¨‹ã€å¹¶å‘çš„ä¸€äº›é—®é¢˜

## ğŸ‘‰ ğŸ‘‰ ä¸ºä½•è¦ç¼–å†™è¿™ä¹ˆä¸€ä¸ªå°é¡¹ç›®

- Java å¤šçº¿ç¨‹ä»¥åŠå¹¶å‘æ˜¯ä¸­é«˜çº§ç¨‹åºçŒ¿ğŸ™‰ ğŸ™‰å¿…å¤‡æŠ€èƒ½
- å¤šçº¿ç¨‹ã€å¹¶å‘ç¨‹åºéš¾ä»¥è°ƒè¯•ï¼Œå¦‚æœä¸æ—¶å¸¸æ¢³ç†ï¼Œæƒ³å½“ç„¶çš„å†™ä»£ç ï¼Œåœ¨çº¿ä¸Šå¯èƒ½ä¼šå‘ç”ŸğŸ‘¿â€œå¹½çµäº‹ä»¶â€

--------------------------------------------------------------------------------

- âœ¨[```Volitale```å…³é”®å­—ä¸Javaçº¿ç¨‹å†…å­˜æ¨¡å‹](#Volitaleå…³é”®å­—ä¸Javaçº¿ç¨‹å†…å­˜æ¨¡å‹)
    - [Demoæ¼”ç¤º](#Demoæ¼”ç¤º)
    - [æ¦‚å¿µåˆ†æ](#æ¦‚å¿µåˆ†æ)
    - [è¿è¡Œå®ä¾‹](#è¿è¡Œå®ä¾‹)





--------------------------------------------------------------------------------

## âœ¨```Volitale```å…³é”®å­—ä¸Javaçº¿ç¨‹å†…å­˜æ¨¡å‹

### Demoæ¼”ç¤º

[VolatileKeyDemo](https://github.com/Byron4j/fuckjava-thread-concurrency/blob/master/src/main/java/org/byron4j/fuckjavathreadconcurrency/volatiletest/VolatileKeyDemo.java)

### æ¦‚å¿µåˆ†æ

  ```Volitale``` å…³é”®å­—ç”¨äºè¡¨ç¤ºå˜é‡çš„çº¿ç¨‹å¯è§æ€§ã€‚åœ¨Javaå†…å­˜æ¨¡å‹(JMM)ä¸­ï¼Œçº¿ç¨‹åŒ…å«3ä¸ªä¸»è¦éƒ¨åˆ†ï¼šçº¿ç¨‹æ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€PCç¨‹åºè®¡æ•°å™¨ã€‚ç±»çš„å®ä¾‹å¯¹è±¡åˆ™å­˜å‚¨ä¸å †ä¸­ã€‚å¤šä¸ªçº¿ç¨‹å…±äº«æ–¹æ³•åŒºå’Œå †ç©ºé—´ã€‚
è€Œåœ¨çº¿ç¨‹æ¨¡å‹ä¸­ï¼Œå˜é‡çœŸå®å€¼å­˜å‚¨åœ¨ä¸»å­˜ä¸­ï¼Œå„ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä¸ªè¯¥å…±äº«å˜é‡çš„å‰¯æœ¬ï¼Œæ“ä½œçš„æ˜¯è‡ªèº«çš„å‰¯æœ¬å€¼ã€‚æ‰€ä»¥çº¿ç¨‹Aåœ¨è‡ªèº«çš„æœ¬åœ°å­˜å‚¨ç©ºé—´ä¸­æ“ä½œå…±äº«å˜é‡æ—¶ï¼Œå…¶å®ƒçš„çº¿ç¨‹å¹¶ä¸æ„ŸçŸ¥ã€‚

>åœ¨ç¼–å†™å•ä¾‹æ¨¡å¼æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨volatileå…³é”®å­—ï¼Œå› ä¸ºvolatileå…³é”®å­—å¯ä»¥ç¦æ­¢JITè¿›è¡ŒæŒ‡ä»¤é‡æ’åºï¼ŒæŒ‡ä»¤é‡æ’åºæ—¶å¯èƒ½å¯¼è‡´åˆå§‹åŒ–æ—¶æŸäº›çº¿ç¨‹è·å–åˆ°çš„å•ä¾‹ä¸ºnullã€‚

  é•¿ä¹…ä»¥æ¥ï¼Œ```volitale``` å…³é”®å­—æ–‡æ¡£æ€§æ¯”è¾ƒå·®ï¼Œç†è§£æ€§ä¹Ÿä¸å¥½ï¼Œä¹Ÿå¾ˆå°‘ä½¿ç”¨ï¼Œä½†æ˜¯åœ¨æœ‰äº›æƒ…å†µå´åˆå¾ˆå¥½ä½¿ç”¨ã€‚
  
 ```volitale``` å…³é”®å­—æœ¬è´¨ä¸Šæ¥è®²ï¼Œæ˜¯æ ‡æ˜è¢«ä¿®é¥°çš„å˜é‡å°†å¯èƒ½è¢«å¤šä¸ªçº¿ç¨‹ä¿®æ”¹ã€‚  
 å¦‚æœå®šä¹‰ä¸€ä¸ªå˜é‡ä¸º ```volitale``` ä¿®é¥°ï¼Œåˆ™è¡¨æ˜ï¼š
    - è¯¥å˜é‡ä¸ä¼šè¢«çº¿ç¨‹æœ¬åœ°ç©ºé—´ç¼“å­˜ï¼Œè€Œæ˜¯çº¿ç¨‹ç›´æ¥è®¿é—®ä¸»å­˜ç©ºé—´ä¸­çš„å€¼
    - è®¿é—®è¯¥å˜é‡æœ‰ç‚¹åƒè¢«åŒ…å«åœ¨```synchronized```å—ä¸­ã€‚
 ```volitale``` è™½ç„¶ç±»ä¼¼```synchronized```ä½†æ˜¯äºŒè€…å¹¶ä¸ä¸€æ ·ï¼Œvolitale å¹¶ä¸åŒ…å«å¯¹å˜é‡åŠ é”ã€‚
 
  ```synchronized``` å’Œ ```volatile``` å¯¹æ¯”ï¼š

|ç‰¹ç‚¹|Synchronized|Volatile|  
|----|----|----|
|å˜é‡ç±»å‹|Object|Objectæˆ–è€…åŸå§‹ç±»å‹|  
|æ˜¯å¦å…è®¸ä¸ºnull|No|Yes|
|æ˜¯å¦å¯ä»¥ä½œä¸ºç¨‹åºå¿«|Yes|No|
|æ‰€æœ‰ç¼“å­˜å˜é‡åœ¨è®¿é—®æ—¶æ˜¯åŒæ­¥çš„å—ï¼Ÿ|Yes|ä»Java5å¼€å§‹|
|ä»€ä¹ˆæ—¶å€™å‘ç”ŸåŒæ­¥ï¼Ÿ|å½“æ˜ç¡®è¿›å…¥æˆ–é€€å‡ºSynchronizedå—æ—¶|ä»»ä½•è®¿é—®å˜é‡æ—¶|
|å¯ä»¥å°†å¤šä¸ªæ“ä½œç»„åˆæˆåŸå­æ“ä½œå—ï¼Ÿ|Yes|Java5ä»¥å Atomic get-set æ˜¯å¯ä»¥çš„|


>**æ³¨æ„äº‹é¡¹**
>
>- å› ä¸ºvolitaleä¸ä¼šæŒæœ‰é”ï¼Œæ‰€ä»¥å¦‚æœè¦è¿›è¡Œè¯»+å†™ï¼Œæ˜¯ä¸åˆé€‚çš„ã€‚å› ä¸ºè¯»åˆ°åï¼Œå…¶å®ƒçº¿ç¨‹å¯èƒ½å·²ç»ä¿®æ”¹äº†å€¼ï¼Œè¿™æ—¶å€™å†å»å†™å¯èƒ½ä¸æ˜¯æœŸæœ›çš„ç»“æœ
>
>- å¯¹äºfinalçš„å˜é‡ï¼Œvolitaleæ˜¯ä¸å¿…è¦çš„
>
>- å•çº¿ç¨‹ç¨‹åºï¼Œvolitaleæ˜¯ä¸å¿…è¦çš„
>
>- volitale ä¸é€‚åˆå¤æ‚çš„æ“ä½œï¼Œæœ€å¥½ä½¿ç”¨synchronizationæˆ–è€…å…¶å®ƒlockç±»

- Javaå†…å­˜æ¨¡å‹

![](articles/1-jmm.jpg)

- Javaçº¿ç¨‹å†…å­˜æ¨¡å‹

![](articles/1-jmm2.jpg)

### è¿è¡Œå®ä¾‹

è¿è¡Œ [VolatileKeyDemo.java](https://github.com/Byron4j/fuckjava-thread-concurrency/blob/master/src/main/java/org/byron4j/fuckjavathreadconcurrency/volatiletest/VolatileKeyDemo.java)

```java
/**
 * volatile å…³é”®å­—ç”¨æ³•
 * stop å¦‚æœä¸æ˜¯ volatile ä¿®é¥°ï¼Œåˆ™threadå¯åŠ¨åï¼Œçœ‹åˆ°çš„æ˜¯è‡ªå·±çº¿ç¨‹æ ˆçš„å˜é‡å€¼falseï¼Œé™·å…¥æ­»å¾ªç¯ï¼›
 * å¦‚æœè¢« volatile ä¿®é¥°ï¼Œåˆ™ stop å˜é‡æ˜¯çº¿ç¨‹å¯è§çš„ï¼Œstop è®¾ç½®ä¸ºtrueåï¼Œthread ä¼šé€€å‡º while å¾ªç¯
 */
```





å‚è€ƒèµ„æ–™:

- [```The volatile keyword in Java```](https://www.javamex.com/tutorials/synchronization_volatile.shtml)
- [æ­£ç¡®ä½¿ç”¨ Volatile å˜é‡](https://www.ibm.com/developerworks/cn/java/j-jtp06197.html)

